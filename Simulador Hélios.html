<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
  <title>Simulador Hélios — Demo</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#f59e0b;--ok:#16a34a;--bad:#ef4444;--glass:rgba(255,255,255,0.04)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial, sans-serif;background:linear-gradient(180deg,#071022 0%, #0b1b2a 100%);color:#e6eef8}
    .app{display:flex;flex-direction:column;height:100vh;padding:12px;gap:12px}

    header{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#fb923c);display:flex;align-items:center;justify-content:center;font-weight:700;color:#061426}
    h1{font-size:1.05rem;margin:0}
    p.lead{margin:0;font-size:0.85rem;color:#cfe3ff}

    .content{display:flex;gap:12px;flex:1;align-items:stretch}
    main{flex:1;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);display:flex;flex-direction:column}
    aside{width:320px;min-width:220px;background:var(--glass);border-radius:12px;padding:12px;backdrop-filter:blur(6px)}

    /* map area */
    .map{position:relative;flex:1;border-radius:8px;overflow:hidden;background:linear-gradient(180deg,#0b2940,#052033);display:flex;align-items:center;justify-content:center}
    .map-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px, transparent 1px);background-size:60px 60px,60px 60px}

    /* cameras */
    .camera{position:absolute;width:64px;height:64px;border-radius:8px;background:rgba(10,12,18,0.8);display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px solid rgba(255,255,255,0.04);background-size:contain;background-repeat:no-repeat}
    .camera.off .eye{background:linear-gradient(180deg,#cbd5e1,#94a3b8);color:#1b2430}
    .camera .label{font-size:0.6rem;color:#cfe3ff;margin-top:4px}

    /* road & vehicles */
    
    .road{
      position:absolute;
      left:6%;
      right:6%;
      height:120px;
      top:58%;
      transform:translateY(-50%);
      border-radius:8px;
      background:linear-gradient(180deg,#28343f,#1b2b36), url('A_2D_digital_illustration_simulates_a_traffic_moni.png') center/cover no-repeat;
      box-shadow:inset 0 2px 6px rgba(0,0,0,0.6);
    }

    .vehicle{position:absolute;top:50%;transform:translateY(-50%);height:48px;min-width:110px;border-radius:8px;display:flex;align-items:center;gap:8px;padding:8px 10px;color:#071426;font-weight:700;pointer-events:auto}
    .vehicle .plate{font-family:monospace;padding:6px 8px;border-radius:6px;background:#fff8;color:#071426}
    .vehicle.car{background-size:64px 64px;background-repeat:no-repeat;background-position:12px center;padding-left:90px}
    .vehicle.bike{background-size:64px 64px;background-repeat:no-repeat;background-position:12px center;padding-left:90px}
    .vehicle.truck{background-size:64px 64px;background-repeat:no-repeat;background-position:12px center;padding-left:90px}

    /* alerts */
    .alerts{display:flex;flex-direction:column;gap:8px}
    .alert{padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-left:6px solid var(--accent)}
    .alert.bad{border-left-color:var(--bad)}
    .alert.ok{border-left-color:var(--ok)}

    .controls{display:flex;flex-direction:column;gap:8px}
    .btn{padding:10px;border-radius:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.04);color:inherit;text-align:center}

    .row{display:flex;gap:8px}
    .small{font-size:0.85rem}

    footer{font-size:0.75rem;color:#9fb6d9}

    /* mobile tweaks */
    @media(max-width:720px){.content{flex-direction:column}.aside{width:100%}aside{order:2;width:100%}aside{min-height:220px}}

    /* esconder placas visualmente */
    .plate {display:none !important;}

    /* animation helper for vehicles */
    .moving{transition:transform 18s linear}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">H</div>
      <div>
        <h1>Sistema Hélios — Simulador (Demo)</h1>
        <p class="lead">Simulação didática de câmeras LPR, leitura de placas e alertas. Mobile-friendly.</p>
      </div>
    </header>

    <div class="content">
      <main>
        <div class="map" id="map">
          <div class="map-grid"></div>

          <!-- road -->
          <div class="road" id="road"></div>

          <!-- cameras -->
          <div class="camera" id="cam1" style="left:12%;top:38%" data-id="CAM-01">
            <div class="label">CAM-01</div>
          </div>

          <div class="camera" id="cam2" style="left:72%;top:38%" data-id="CAM-02">
            <div class="label">CAM-02</div>
          </div>

          <!-- vehicles container -->
          <div id="vehicles" style="position:absolute;inset:0;pointer-events:none"></div>

        </div>

        <div style="margin-top:10px;display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div class="row">
            <button class="btn" id="spawnCar">Gerar veículo</button>
            <button class="btn" id="spawnTruck">Gerar caminhão</button>
            <button class="btn" id="spawnBike">Gerar moto</button>
            <button class="btn" id="reset">Resetar</button>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <div class="small">Toque na câmera para ligar/desligar</div>
          </div>
        </div>
      </main>

      <aside>
        <div class="controls">
          <div style="display:flex;gap:8px;align-items:center">
            <input id="manualPlate" placeholder="Digite a placa (ex: ABC1D23)" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
            <button class="btn" id="checkPlate">Verificar</button>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <label style="font-size:0.85rem">Banco simulado:</label>
            <select id="dbPreset" style="flex:1;padding:8px;border-radius:8px;background:transparent;color:inherit">
              <option value="default">Padrão (algumas irregulares)</option>
              <option value="clean">Sem irregularidades</option>
              <option value="many">Muitas irregularidades (teste)</option>
            </select>
          </div>

          <div>
            <strong>Status das Câmeras</strong>
            <div id="camsStatus" style="margin-top:8px"></div>
          </div>

          <div>
            <strong>Alertas</strong>
            <div id="alerts" class="alerts" style="margin-top:8px;max-height:260px;overflow:auto"></div>
          </div>

          <div style="margin-top:8px;display:flex;gap:8px;flex-direction:column">
            <small>Instruções rápidas:</small>
            <ul style="margin:8px 0;padding-left:18px;color:#cfe3ff">
              <li>Gerar veículos e observe quando passam pela área de cobertura da câmera.</li>
              <li>Toque na câmera para habilitar/desabilitar leitura.</li>
              <li>Use entrada manual para testar placas específicas.</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <footer>Pronto para apresentar — digitalize um QR que aponte para este arquivo num servidor local. Precisa de ajuda para gerar o QR? Peça que eu explique.</footer>
  </div>

  <!-- IMAGENS (cartoon SVG inline como data URIs) -->
  <script>
    // cartoon 64x64 SVGs as data URIs
    const vehicleImages = {
      car: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect rx='8' x='6' y='18' width='52' height='22' fill='%2360a5fa'/><rect x='12' y='10' width='36' height='14' rx='4' fill='%23478ee0'/><circle cx='20' cy='44' r='5' fill='%23000'/><circle cx='44' cy='44' r='5' fill='%23000'/></svg>",
      bike: "data:image/svg+xml;utf8,<svg style='transform:scaleX(-1)' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='18' cy='44' r='6' fill='%23000'/><circle cx='46' cy='44' r='6' fill='%23000'/><rect x='24' y='22' width='16' height='6' rx='3' fill='%23ef4444'/><rect x='30' y='16' width='4' height='12' rx='2' fill='%23ef4444'/></svg>",
      truck: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='4' y='20' width='40' height='20' rx='3' fill='%23fb923c'/><rect x='44' y='26' width='14' height='12' rx='2' fill='%23f97316'/><circle cx='18' cy='44' r='5' fill='%23000'/><circle cx='46' cy='44' r='5' fill='%23000'/></svg>"
    };

    const cameraImage = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='20' y='8' width='24' height='36' rx='3' fill='%2394a3b8'/><rect x='14' y='20' width='12' height='8' rx='2' fill='%232f3a44'/><circle cx='32' cy='26' r='6' fill='%231b2630'/><rect x='28' y='44' width='8' height='12' rx='2' fill='%2394a3b8'/></svg>";

    // Apply camera images as background
    document.addEventListener('DOMContentLoaded',()=>{
      const cam1 = document.getElementById('cam1');
      const cam2 = document.getElementById('cam2');
      if(cam1) cam1.style.backgroundImage = `url("${cameraImage}")`;
      if(cam2) cam2.style.backgroundImage = `url("${cameraImage}")`;
    });
  </script>

  <script>
    // Simulador Hélios — JavaScript (atualizado para usar imagens cartoon)
    const camEls = [document.getElementById('cam1'), document.getElementById('cam2')];
    const vehiclesEl = document.getElementById('vehicles');
    const alertsEl = document.getElementById('alerts');
    const camsStatusEl = document.getElementById('camsStatus');
    const manualPlateEl = document.getElementById('manualPlate');
    const checkPlateBtn = document.getElementById('checkPlate');
    const spawnCarBtn = document.getElementById('spawnCar');
    const spawnTruckBtn = document.getElementById('spawnTruck');
    const spawnBikeBtn = document.getElementById('spawnBike');
    const resetBtn = document.getElementById('reset');
    const dbPreset = document.getElementById('dbPreset');

    // Simulated DB of irregular plates and reasons
    let db = {
      'ABC1D23': {type:'roubado', info:'Veículo com ocorrência de roubo (registro 2024-09-12)'} ,
      'XYZ9Z99': {type:'restricao', info:'Restrição administrativa (documentação pendente)'} ,
      'TPL0T12': {type:'furto', info:'Furto registrado - investigação em andamento'}
    };

    function loadPreset(p){
      if(p==='clean') db = {};
      else if(p==='many') db = {};
      else db = {'ABC1D23':{type:'roubado',info:'Roubo 2024'},'XYZ9Z99':{type:'restricao',info:'IPVA vencido'},'TPL0T12':{type:'furto',info:'Furto recente'}}
      addAlert('Preset carregado: '+p,'ok');
      renderCamsStatus();
    }

    loadPreset('default');

    function renderCamsStatus(){
      camsStatusEl.innerHTML = '';
      camEls.forEach(cam=>{
        const on = !cam.classList.contains('off');
        const div = document.createElement('div');
        div.textContent = cam.dataset.id + ' — ' + (on? 'Ativa':'Desativada');
        div.style.padding='6px';
        div.style.borderRadius='6px';
        div.style.background = on? 'linear-gradient(90deg,rgba(16,185,129,0.06),transparent)':'linear-gradient(90deg,rgba(239,68,68,0.02),transparent)';
        camsStatusEl.appendChild(div);
      });
    }

    renderCamsStatus();

    // Helper: generate plate like ABC1D23
    function randomPlate(){
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const nums = '0123456789';
      function pick(str,n){let s='';for(let i=0;i<n;i++) s+=str[Math.floor(Math.random()*str.length)];return s}
      return pick(letters,3)+pick(nums,1)+pick(letters,1)+pick(nums,2);
    }

    // Spawn vehicle
    let vehicleCount = 0;
    function spawnVehicle(kind='car'){
      vehicleCount++;
      const id = 'veh'+vehicleCount;
      const el = document.createElement('div');
      el.className = 'vehicle '+(kind==='car'? 'car' : kind==='bike' ? 'bike' : 'truck');
      el.id = id;
      el.style.left = '-18%';
      const plate = randomPlate();
      el.dataset.plate = plate;

      // set background image from vehicleImages
      if(kind==='car') el.style.backgroundImage = `url("${vehicleImages.car}")`;
      else if(kind==='bike') el.style.backgroundImage = `url("${vehicleImages.bike}")`;
      else el.style.backgroundImage = `url("${vehicleImages.truck}")`;

      el.innerHTML = `<div style="width:36px;height:28px;border-radius:6px;background:rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;font-size:0.85rem"></div><div class="plate">${plate}</div>`;
      vehiclesEl.appendChild(el);

      // start moving across (transform translate)
      requestAnimationFrame(()=>{
        el.classList.add('moving');
        el.style.transform = 'translateX(140vw)';
        // check over time for camera detection
        const start = Date.now();
        const duration = 18000 + Math.random()*6000; // 3x mais lento // ms
        const tick = () => {
          const t = (Date.now()-start)/duration; // 0..1
          // compute pseudo position in % along road
          const pos = -18 + t*160; // left percent
          el.style.left = pos+'%';

          // detect with cameras: simple distance check
          camEls.forEach(cam=>{
            if(cam.classList.contains('off')) return;
            const camRect = cam.getBoundingClientRect();
            const vehRect = el.getBoundingClientRect();
            const camX = camRect.left + camRect.width/2;
            const vehX = vehRect.left + vehRect.width/2;
            const dx = Math.abs(camX - vehX);
            const dy = Math.abs((camRect.top+camRect.height/2) - (vehRect.top+vehRect.height/2));
            if(dx < 120 && dy < 100 && !el.dataset.detectedBy?.includes(cam.dataset.id)){
              el.dataset.detectedBy = (el.dataset.detectedBy||'') + cam.dataset.id + ';';
              onDetect(cam.dataset.id, el.dataset.plate, {x:vehRect.left, y:vehRect.top});
            }
          });

          if(t<1) requestAnimationFrame(tick);
          else { // remove
            el.remove();
          }
        };
        tick();
      });

      // allow tapping vehicle to force-check
      el.addEventListener('click',()=>{
        checkPlate(plate,true);
      });
    }

    function onDetect(camId, plate, coords){
      addAlert(`Câmera ${camId} detectou placa ${plate} — consultando banco...`,'ok');
      setTimeout(()=>{
        if(db[plate]){
          addAlert(`⚠️ ALERTA: ${plate} - ${db[plate].type.toUpperCase()} (${db[plate].info}) — detectada por ${camId}`,'bad');
          const cam = camEls.find(c=>c.dataset.id===camId);
          if(cam){cam.style.boxShadow='0 0 18px rgba(239,68,68,0.9)';setTimeout(()=>cam.style.boxShadow='',650)}
        } else {
          addAlert(`${plate} verificada: nenhuma irregularidade encontrada. (cam: ${camId})`,'ok');
        }
      },600 + Math.random()*800);
    }

    function addAlert(text,cls='ok'){
      const d = document.createElement('div');
      d.className = 'alert '+(cls==='bad'?'bad':'ok');
      d.innerHTML = `<div style="font-size:0.9rem">${text}</div><div style="font-size:0.75rem;color:#9fb6d9;margin-top:6px">${new Date().toLocaleTimeString()}</div>`;
      alertsEl.prepend(d);
      while(alertsEl.children.length>12) alertsEl.removeChild(alertsEl.lastChild);
    }

    // manual check
    function checkPlate(plate,fromUI=false){
      plate = (plate||'').toUpperCase().replace(/[^A-Z0-9]/g,'');
      if(!plate) return addAlert('Placa vazia.','ok');
      addAlert(`Consulta manual: ${plate}`,'ok');
      setTimeout(()=>{
        if(db[plate]) addAlert(`⚠️ ALERTA: ${plate} - ${db[plate].type.toUpperCase()} (${db[plate].info})`,'bad');
        else addAlert(`${plate} - Sem irregularidades encontradas.`,'ok');
      },400);
    }

    checkPlateBtn.addEventListener('click',()=>checkPlate(manualPlateEl.value,true));

    spawnCarBtn.addEventListener('click',()=>spawnVehicle('car'));
    spawnTruckBtn.addEventListener('click',()=>spawnVehicle('truck'));
    spawnBikeBtn.addEventListener('click',()=>spawnVehicle('bike'));

    resetBtn.addEventListener('click',()=>{alertsEl.innerHTML='';document.querySelectorAll('.vehicle').forEach(v=>v.remove());addAlert('Simulação reiniciada','ok')});

    camEls.forEach(cam=>{
      cam.addEventListener('click',()=>{
        cam.classList.toggle('off');
        renderCamsStatus();
      });
    });

    dbPreset.addEventListener('change',()=>loadPreset(dbPreset.value));

    let auto = setInterval(()=>{ if(Math.random()>0.3) spawnVehicle(Math.random()>0.6?'truck':'car') }, 2800);

    document.getElementById('map').addEventListener('click',(e)=>{
      if(e.target.classList.contains('camera')) return;
      spawnVehicle(Math.random()>0.7?'truck':'car');
    });

    if(/Mobi|Android/i.test(navigator.userAgent)){
      addAlert('Modo móvel detectado — pronto para demonstração via QR. Toque no mapa para gerar veículos.', 'ok');
    }

    window._sim = {spawnVehicle,loadPreset,db,vehicleImages,cameraImage};
  </script>
</body>
</html>
