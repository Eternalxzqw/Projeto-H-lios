<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0" />
  <title>Simulador HÃ©lios â€” Mobile</title>
  <style>
    /* Reset & base */
    :root{
      --bg:#a99663; --card:#0b1220; --accent:#f59e0b; --muted:#9fb6d9; --ok:#16a34a; --bad:#ef4444;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#071022 0%, #0b1b2a 100%);color:#e6eef8}

    /* App layout fits exactly the viewport (no scroll) */
    .app{display:flex;flex-direction:column;height:100vh;gap:6px;padding:8px;box-sizing:border-box}

    header{display:flex;align-items:center;gap:10px}
    .logo{width:56px;height:56px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:var(--accent);overflow:hidden;border:2px solid rgba(255,255,255,0.08)}
    h1{font-size:clamp(14px,2.2vw,18px);margin:0}
    p.lead{margin:0;font-size:clamp(11px,2vw,13px);color:#cfe3ff}

    /* main content: map on top, controls below â€” fits on screen without scroll */
    .content{display:flex;flex-direction:column;flex:1;gap:8px}

    /* map area uses viewport height fraction so page doesn't scroll */
    .map{position:relative;border-radius:8px;overflow:hidden;background:linear-gradient(180deg,#0b2940,#052033);display:flex;align-items:center;justify-content:center;height:62vh}
    .map-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px, transparent 1px);background-size:48px 48px,48px 48px;opacity:0.6}

    /* road scaled down for mobile */
    .road{position:absolute;left:6%;right:6%;height:90px;top:58%;transform:translateY(-50%);border-radius:8px;background:linear-gradient(180deg,#28343f,#1b2b36);box-shadow:inset 0 1px 4px rgba(0,0,0,0.6)}

    /* cameras smaller */
    .camera{position:absolute;width:48px;height:48px;border-radius:6px;background:rgba(10,12,18,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px solid rgba(255,255,255,0.04);background-size:contain;background-repeat:no-repeat}
    .camera .label{font-size:10px;color:#cfe3ff;margin-top:2px}

    /* vehicles smaller for mobile */
    .vehicle{position:absolute;top:50%;transform:translateY(-50%);height:36px;min-width:88px;border-radius:8px;display:flex;align-items:center;gap:6px;padding:6px 8px;color:#071426;font-weight:700;pointer-events:auto;font-size:12px}
    .vehicle .plate{font-family:monospace;padding:4px 6px;border-radius:6px;background:#fff8;color:#071426;font-size:11px}
    .vehicle.car{background-size:48px 48px;background-repeat:no-repeat;background-position:10px center;padding-left:72px}
    .vehicle.bike{background-size:48px 48px;background-repeat:no-repeat;background-position:10px center;padding-left:72px}
    .vehicle.truck{background-size:48px 48px;background-repeat:no-repeat;background-position:10px center;padding-left:72px}

    /* controls area below map, fixed height so no scrolling */
    .controls-wrap{display:flex;flex-direction:column;gap:6px;height:34vh;box-sizing:border-box}
    .controls{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .btn{flex:1;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);color:inherit;text-align:center;font-size:14px}
    .small{font-size:12px}

    /* alerts area compact scroll inside fixed box */
    .alerts{margin-top:6px;display:flex;flex-direction:column;gap:6px;max-height:110px;overflow:auto;padding-right:6px}
    .alert{padding:8px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-left:6px solid var(--accent);font-size:12px}
    .alert.bad{border-left-color:var(--bad);background:rgba(239,68,68,0.5);}
    .alert.ok{border-left-color:var(--ok);background:rgba(22,163,74,0.5);}

    footer{font-size:11px;color:var(--muted);text-align:center}

    /* hide plates visually if desired (keeps data attribute) */
    .plate{display:none}

    /* animation smoothing for mobile (duration controlled in JS) */
    .moving{transition:transform linear}

    @media (min-width:720px){
      /* slightly larger tablet layout */
      .map{height:68vh}
      .controls-wrap{height:30vh}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo" style="width:56px;height:56px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;color:#061426;font-size:18px;">CTPM</div>
      <div>
        <h1>Simulador HÃ©lios</h1>
        <p class="lead"><strong>Feito por JoÃ£o Pedro Vieira da Cunha</strong></p>
      </div>
    </header>

    <div class="content">
      <main>
        <div class="map" id="map">
          <div class="map-grid"></div>

          <!-- road -->
          <div class="road" id="road"></div>

          <!-- cameras -->
          <div class="camera" id="cam1" style="left:10%;top:36%" data-id="CAM-01"><div class="label">CAM-01</div></div>
          <div class="camera" id="cam2" style="left:74%;top:36%" data-id="CAM-02"><div class="label">CAM-02</div></div>

          <!-- vehicles container -->
          <div id="vehicles" style="position:absolute;inset:0;pointer-events:none"></div>
        </div>

        <div class="controls-wrap">
          <div class="controls">
            <button class="btn" id="spawnCar">Gerar Carro</button>
            <button class="btn" id="spawnBike">Gerar Moto</button>
            <button class="btn" id="spawnTruck">Gerar CaminhÃ£o</button>
            <button class="btn" id="reset">Resetar</button>
          </div>

          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;padding:0 4px">
            <input id="manualPlate" placeholder="Placa (ex: ABC1D23)" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:13px">
            <button class="btn" id="checkPlate" style="flex:0 0 110px;margin-left:6px">Verificar</button>
          </div>

          <div style="padding:0 4px">
            <strong style="font-size:13px">Alertas</strong>
            <div id="alerts" class="alerts"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- images: small cartoon SVG data URIs (kept in JS for flexibility) -->
  <script>
    // small SVGs used as data URIs
    const vehicleImages = {
      car: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect rx='8' x='6' y='18' width='52' height='22' fill='%2360a5fa'/><rect x='12' y='10' width='36' height='14' rx='4' fill='%23478ee0'/><circle cx='20' cy='44' r='5' fill='%23000'/><circle cx='44' cy='44' r='5' fill='%23000'/></svg>",
      bike: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='18' cy='44' r='6' fill='%23000'/><circle cx='46' cy='44' r='6' fill='%23000'/><rect x='24' y='22' width='16' height='6' rx='3' fill='%23ef4444'/><rect x='30' y='16' width='4' height='12' rx='2' fill='%23ef4444'/></svg>",
      truck: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='4' y='20' width='40' height='20' rx='3' fill='%23fb923c'/><rect x='44' y='26' width='14' height='12' rx='2' fill='%23f97316'/><circle cx='18' cy='44' r='5' fill='%23000'/><circle cx='46' cy='44' r='5' fill='%23000'/></svg>"
    };

    const cameraImage = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='20' y='8' width='24' height='36' rx='3' fill='%2394a3b8'/><rect x='14' y='20' width='12' height='8' rx='2' fill='%232f3a44'/><circle cx='32' cy='26' r='6' fill='%231b2630'/><rect x='28' y='44' width='8' height='12' rx='2' fill='%2394a3b8'/></svg>";

    document.addEventListener('DOMContentLoaded',()=>{
      const cam1 = document.getElementById('cam1');
      const cam2 = document.getElementById('cam2');
      if(cam1) cam1.style.backgroundImage = `url("${cameraImage}")`;
      if(cam2) cam2.style.backgroundImage = `url("${cameraImage}")`;
    });
  </script>

  <script>
    // Mobile-adapted simulator logic
    document.addEventListener('DOMContentLoaded',()=>{
      const camEls = [document.getElementById('cam1'), document.getElementById('cam2')];
      const vehiclesEl = document.getElementById('vehicles');
      const alertsEl = document.getElementById('alerts');
      const manualPlateEl = document.getElementById('manualPlate');
      const checkPlateBtn = document.getElementById('checkPlate');
      const spawnCarBtn = document.getElementById('spawnCar');
      const spawnTruckBtn = document.getElementById('spawnTruck');
      const spawnBikeBtn = document.getElementById('spawnBike');
      const resetBtn = document.getElementById('reset');

      const dbPreset = { value: 'default' };
      let db = {'ABC1D23':{type:'roubado',info:'Roubo 2024'},'XYZ9Z99':{type:'restricao',info:'IPVA vencido'}};

      function addAlert(text,cls='ok'){
        const d = document.createElement('div');
        d.className = 'alert '+(cls==='bad'?'bad':'ok');
        d.innerHTML = `${text}<div style='font-size:11px;color:var(--muted);margin-top:6px'>${new Date().toLocaleTimeString()}</div>`;
        alertsEl.prepend(d);
        while(alertsEl.children.length>8) alertsEl.removeChild(alertsEl.lastChild);
      }

      function randomPlate(){
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const nums = '0123456789';
        function pick(s,n){let r='';for(let i=0;i<n;i++) r+=s[Math.floor(Math.random()*s.length)];return r}
        return pick(letters,3)+pick(nums,1)+pick(letters,1)+pick(nums,2);
      }

      // spawn only by button; vehicles always start from same point
      let vehicleCount = 0;
      const startLeftPercent = -14; // off-screen start
      function spawnVehicle(kind){
        vehicleCount++;
        const id = 'veh'+vehicleCount;
        const el = document.createElement('div');
        el.className = 'vehicle '+(kind==='car'?'car': kind==='bike'?'bike':'truck');
        el.id = id;
        el.style.left = startLeftPercent+'%';
        const plate = randomPlate();
      el.dataset.plate = plate;

      // marcar ~20% dos veÃ­culos como suspeitos automaticamente (OpÃ§Ã£o A)
      try{
        if(Math.random() < 0.20){
          db[plate] = { type: 'suspeito', info: 'Marcado automaticamente (probabilidade 20%)' };
          el.dataset.autoSus = '1';
        }
      }catch(e){ console.warn('Erro ao marcar veÃ­culo suspeito automaticamente', e); }

        // set background image
        if(kind==='car') el.style.backgroundImage = `url("${vehicleImages.car}")`;
        else if(kind==='bike') el.style.backgroundImage = `url("${vehicleImages.bike}")`;
        else el.style.backgroundImage = `url("${vehicleImages.truck}")`;

        el.innerHTML = `<div style="width:30px;height:20px;border-radius:4px;background:rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;font-size:11px"></div><div class="plate">${plate}</div>`;
        vehiclesEl.appendChild(el);

        // animate across screen â€” slower but mobile-friendly values
        const duration = 14000 + Math.random()*3000; // 14-17s
        const start = Date.now();
        const tick = () => {
          const t = Math.min(1,(Date.now()-start)/duration);
          const pos = startLeftPercent + t*(160); // -14% -> 146%
          el.style.left = pos + '%';

          // detection check
          camEls.forEach(cam=>{
            if(!cam || cam.classList.contains('off')) return;
            const camRect = cam.getBoundingClientRect();
            const vehRect = el.getBoundingClientRect();
            const camX = camRect.left + camRect.width/2;
            const vehX = vehRect.left + vehRect.width/2;
            const dx = Math.abs(camX - vehX);
            const dy = Math.abs((camRect.top+camRect.height/2) - (vehRect.top+vehRect.height/2));
            if(dx < 90 && dy < 80 && !el.dataset.detectedBy?.includes(cam.dataset.id)){
              el.dataset.detectedBy = (el.dataset.detectedBy||'') + cam.dataset.id + ';';
              onDetect(cam.dataset.id, plate);
            }
          });

          if(t<1) requestAnimationFrame(tick);
          else el.remove();
        };
        requestAnimationFrame(tick);

        // allow touch to force-check
        el.addEventListener('click',()=>checkPlate(plate,true));
      }

      function onDetect(camId, plate){
        addAlert(`CÃ¢mera ${camId} detectou placa ${plate} â€” consultando banco...`,'ok');
        setTimeout(()=>{
          if(db[plate]){
            const mensagensSuspeitas = [
              'ðŸš¨ VeÃ­culo roubado!',
              'ðŸš¨ Envolvido com trÃ¡fico!',
              'ðŸš¨ Suspeito de sequestro!',
              'ðŸš¨ Ligado a assaltos!',
              'ðŸš¨ Furto registrado!',
              'ðŸš¨ Procurado pela polÃ­cia!',
              'ðŸš¨ Usado em fuga recente!'
            ];
            const msg = mensagensSuspeitas[Math.floor(Math.random()*mensagensSuspeitas.length)];
            addAlert(`${msg} (${plate})`,'bad');
          }
          else addAlert(`${plate} verificada: sem irregularidades.`,'ok');
        },500 + Math.random()*600);
      }

      function checkPlate(plate,fromUI=false){
        plate = (plate||'').toUpperCase().replace(/[^A-Z0-9]/g,'');
        if(!plate) return addAlert('Placa vazia.','ok');
        addAlert(`Consulta manual: ${plate}`,'ok');
        setTimeout(()=>{
          if(db[plate]) addAlert(`âš ï¸ ALERTA: ${plate} - ${db[plate].type.toUpperCase()} (${db[plate].info})`,'bad');
          else addAlert(`${plate} - Sem irregularidades encontradas.`,'ok');
        },400);
      }

      // wire buttons (only manual spawn) - check existence first to avoid errors
      if(spawnCarBtn) spawnCarBtn.addEventListener('click',()=>spawnVehicle('car'));
      else console.warn('spawnCarBtn not found');
      if(spawnBikeBtn) spawnBikeBtn.addEventListener('click',()=>spawnVehicle('bike'));
      else console.warn('spawnBikeBtn not found');
      if(spawnTruckBtn) spawnTruckBtn.addEventListener('click',()=>spawnVehicle('truck'));
      else console.warn('spawnTruckBtn not found');

      if(checkPlateBtn) checkPlateBtn.addEventListener('click',()=>checkPlate(manualPlateEl.value,true));
      if(resetBtn) resetBtn.addEventListener('click',()=>{alertsEl.innerHTML='';document.querySelectorAll('.vehicle').forEach(v=>v.remove());addAlert('SimulaÃ§Ã£o reiniciada','ok')});

      // camera toggle
      camEls.forEach(cam=>{ if(cam) cam.addEventListener('click',()=>{ cam.classList.toggle('off'); addAlert(cam.dataset.id + (cam.classList.contains('off')? ' â€” Desativada':' â€” Ativada'), 'ok'); })});

      // no auto-spawn and no map-click spawn (manual only)

      if(/Mobi|Android/i.test(navigator.userAgent)){
        addAlert('Modo mÃ³vel detectado â€” use os botÃµes para gerar veÃ­culos.', 'ok');
      }

      window._sim = { spawnVehicle, checkPlate, db };
    });
  </script>
</body>
</html>
